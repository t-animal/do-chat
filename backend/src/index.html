<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Chat app</title>
    <link rel="stylesheet" href="./style.css" />
  </head>
  <body>
    <nav class="sidebar">
      <h2>Navigation</h2>
      <ul>
        <li>Server</li>
        <li>Chat</li>
      </ul>
    </nav>
    <main>
      <h1>Server</h1>
      Status: <span class="server-state"></span><br/>
      <span class="address-info" style="visibility: hidden">Adressen: Die app l√§uft unter <span class="frontend-address"></span>.
      Gib in den Einstellungen als Server-Adresse <span class="backend-address"></span> ein. </span><br /><br />
      <button onclick="wrappedStartServer()">Start server</button>
      <button onclick="wrappeStopServer()">Stop server</button>
    </main>

  <script>
      const { startServer, stopServer } = require('./socket-server.js');
      const { startWebServer, stopWebServer } = require('./web-server.js');
      const ip = require('ip');
  
      let isRunning = false;
      function wrappedStartServer() {
        if(isRunning){
          return;
        }
        startServer();
        startWebServer();
        isRunning = true;
        writeServerState();
      }

      function wrappeStopServer() {
        if(!isRunning) {
          return;
        }
        stopServer();
        stopWebServer();
        isRunning = false;
        writeServerState();
      }
  
      function writeServerState() {
        document.querySelector(".server-state").textContent = isRunning ? 'Gestartet' : 'Gestoppt';
        document.querySelector(".frontend-address").textContent = `http://${ip.address()}:8081`;
        document.querySelector(".backend-address").textContent = `ws://${ip.address()}:8080`;
        document.querySelector(".address-info").style.visibility = isRunning ? 'visible' : 'hidden';
      }

      writeServerState();
    </script>
  </body>
</html>